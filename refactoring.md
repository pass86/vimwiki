# 重构的重新认识
* 重构是在不改变软件可观察行为的前提下改善其内部结构

# 重构的第一步
* 我得为即将修改的代码建立一组可靠的测试环境

# 分解并重组statement()
* 任何一个傻瓜都能写出计算机可以理解的代码。唯有写出人类容易理解的代码，才是优秀的程序员。
* 代码应该表现自己的目的，这一点非常重要
* 绝大多数情况下，函数应该放在它使用的数据的所属对象内

# 运用多态取代与价格相关的条件逻辑
* 最好不要在另一个对象的属性基础上运用switch语句。如果不得不使用，也应该在对象自己的数据上使用，而不是在别人的数据上使用。
* Replace Type Code with State/Strategy
* Move Method
* Replace Conditional with Polymorphism

# 结语
* 这个例子给我们最大的启发是重构的节奏：测试、小修改、测试、小修改、测试、小修改......正是这种节奏让重构得以快速而安全地前进

# 何谓重构
* 重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本
* 重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构

# 何时重构
* 事不过三，三则重构
* 难以阅读的程序，难以修改
* 逻辑重复的程序，难以修改
* 添加新行为时需要修改已有代码的程序，难以修改
* 带复杂条件逻辑的程序，难以修改

# 重构的难题
* 重写（而非重构）的一个清楚讯号就是：现有代码根本不能正常运作
* 如果项目已近最后期限，你也应该避免重构

# Long Method（过长函数）
* “间接层”所能带来的全部利益--解释能力、共享能力、选择能力--都是由小型函数支持的
* 每当感觉需要以注释来说明点什么的时候，我们就把需要说明的东西写进一个独立函数中，并以其用途（而非实现手法）命名

# 自测试代码的价值
* 编写测试代码其实就是在问自己：添加这个功能需要做些什么
* 编写测试代码还能使你把注意力集中于接口而非实现（这永远是件好事）

# 单元测试和功能测试
* 每当你收到bug报告，请先写一个单元测试来暴露这个bug

# 添加更多测试
* 测试的要诀是：测试你最担心出错的部分
* 测试的一项重要技巧就是“寻找边界条件”

# 这些重构手法有多熟
* 模式是你希望到达的目标，重构则是到达之路。

# Extract Method（提炼函数）
* 将这段代码放进一个独立函数中，并让函数名称解释该函数的用途
* 这会使高层函数读起来就像一系列注释

# Inline Method（内联函数）
* 在函数调用点插入本体，然后移除该函数

# Inline Temp（内联临时变量）
* 将所有对该变量的引用动作，替换为对它赋值的那个表达式自身

# Replace Temp with Query（以查询取代临时变量）
* 将这个表达式提炼到一个独立函数中。将这个临时变量的所有引用点替换为对新函数的调用。此后，新函数就可被其他函数使用。
* 找出只被赋值一次的临时变量

# Introduce Explaining Variable（引入解释性变量）
* 将该复杂表达式（或其中一部分）的结果放进一个临时变量，以此变量名称来解释表达式用途

